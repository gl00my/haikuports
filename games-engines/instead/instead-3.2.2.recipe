SUMMARY="Simple Text Adventures, The Interpreter"
DESCRIPTION="INSTEAD was designed to make the textographic games.\
These games are mix of interactive fiction, visual novels and classic point & click adventures.\
Adventure begins! \
\
(Get games from http://instead-games.ru and unpack them into ~/.instead/games)"

HOMEPAGE="https://instead-hub.github.io/"
COPYRIGHT="2009-2018 Peter Kosyh"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/instead-hub/instead/releases/download/3.2.2/instead_3.2.2.tar.gz"
CHECKSUM_SHA256="fd3e732e548a36ae85a27ea2e0743fd8c097ab8b613fc6e4b86a762fd15def1f"
ADDITIONAL_FILES="instead.rdef.in"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	instead = $portVersion
	app:instead${secondaryArchSuffix} = $portVersion
	"

REQUIRES="
	haiku$secondaryArchSuffix
	lib:libintl${secondaryArchSuffix}
	lib:libsdl${secondaryArchSuffix}
	lib:libsdl_mixer${secondaryArchSuffix}
	lib:libsdl_image${secondaryArchSuffix}
	lib:libsdl_ttf${secondaryArchSuffix}
	lib:libluajit_5.1${secondaryArchSuffix}
	lib:libiconv${secondaryArchSuffix}
	lib:libz${secondaryArchSuffix}
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libsdl${secondaryArchSuffix}
	devel:libsdl_mixer${secondaryArchSuffix}
	devel:libsdl_image${secondaryArchSuffix}
	devel:libsdl_ttf${secondaryArchSuffix}
	devel:libiconv${secondaryArchSuffix}
	devel:libluajit_5.1${secondaryArchSuffix}
	devel:libz${secondaryArchSuffix}
	"

BUILD_PREREQUIRES="
	cmd:gcc${secondaryArchSuffix}
	cmd:ld${secondaryArchSuffix}
	cmd:make
	cmd:pkg_config${secondaryArchSuffix}
	"

BUILD()
{
	mkdir doc/saved && mv doc/*.pdf doc/*.txt doc/saved 
	echo "2" | ./configure.sh 
	mv doc/saved/* doc/ && rm -rf doc/saved
	make $jobArgs PREFIX="$appsDir/Instead" \
		BIN="$appsDir/Instead" DESTDIR=/ \
		DATAPATH="$appsDir/Instead/data" \
		DOCPATH="$appsDir/Instead/documentation" \
		ICONPATH="$appsDir/Instead/data/icon"
}

INSTALL()
{
	make install PREFIX="$appsDir/Instead" \
		BIN="$appsDir/Instead" DESTDIR=/ \
		DATAPATH="$appsDir/Instead/data" \
		DOCPATH="$appsDir/Instead/documentation" \
		ICONPATH="$appsDir/Instead/data/icon"
	# Clean up some unnecessary things from the package
	rm -rf "$appsDir/Instead/share"
	rm -rf "$appsDir/Instead/instead"
	mv "$appsDir/Instead/sdl-instead" "$appsDir/Instead/Instead"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		$portDir/additional-files/instead.rdef.in > instead.rdef
	addResourcesToBinaries instead.rdef $appsDir/Instead/Instead
	addAppDeskbarSymlink "$appsDir/Instead/Instead" "INSTEAD"
}
